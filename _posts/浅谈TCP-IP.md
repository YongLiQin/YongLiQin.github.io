---
title: 浅谈TCP/IP
date: 2017-10-21 22:46:48
tags: TCP/IP
categories: Internet
---

## 序言

作为一名计算机科学与技术的工科生，了解计算机网络基础是必须的。网络通讯遍布在我们身边，从本博客开始，将启航我在计算机网络上的系列学习。

<!--more-->

## OSI七层模型

OSI 模型(开放系统互联模型)是一个由国际标准化组织(ISO)提出概念模型,试图提供一个使各种不同的计算机和网络在世界范围内实现互联的标准框架。

OSI　将计算机网络体系结构划分为七层,每层都可以提供抽象良好的接口。了解 OSI 模型有助于理解实际上互联网络的工业标准——TCP/IP 协议。

七层协议，从下往上

1. 物理层(网络物理硬件)
2. 链路层(网络特有的链路接口)
3. 网络层(IP)
4. 传输层(TCP/UDP)
5. 会话层(通信连接/维持会话)
6. 表示层(加密/解密等)
7. 应用层(HTTP、SMTP、IMAP等)

附上三个图促进理解

![OSI图片](/img/OSI1.jpg)

![OSI图片](/img/OSI2.gif)

![OSI图片](/img/OSI3.png)

> 物理地址，又称网卡的硬件MAC地址(处于数据链路层)负责局域网通讯，IP地址(处于网络层)负责外网通讯

## TCP/IP

### 定义

TCP/IP模型也被称作DoD模型(Department of Defense Model)。TCP/IP字面上代表了两个协议：TCP（传输控制协议）和IP（网际协议）。但TCP/IP协议不是TCP和IP这两个协议的合称，而是指因特网整个TCP/IP协议族。从协议分层模型方面来讲，TCP/IP由四个层次组成:网络接口层、网络层、传输层、应用层。TCP/IP通讯协议采用了4层的层级结构，每一层都呼叫它的下一层所提供的网络来完成自己的需求。

> OSI模型所分的七层,在实际应用中,往往有一些层被整合,或者功能分散到其他层去。

> TCP是一种面向连接的、可靠的、基于字节流的传输层通信协议。

> TCP/IP 的设计,是吸取了分层模型的精华思想——封装。每层对上一层提供服务的时候,上一层的数据结构是黑盒,直接作为本层的数据,而不需要关心上一层协议的任何细节

四层模型:

![tcp/ip四层模型图](/img/tipcip&osi.png)

![tcp/ip图片](/img/application.png)

TCP/IP 分层模型的分层以以太网上传输 UDP 数据包如图所示

![tcp/ip图片](/img/TCPIP.png)

各层中的协议

![](/img/protocol.jpg)

![tcpip通讯流](/img/tcpipstream.jpg)

基于tcp的文件传输(ftp－port21)

![](/img/datapackage.png)

基于TCP和UDP的数据封装及解析示例如下：

![](/img/package.jpg)

TCP数据包

![](/img/tcppackage.jpg)

tcp在真正连接前要经过三次握手，断开连接需要经过四次挥手

TCP三次握手

![](/img/threeShake.png)

TCP四次挥手

- 第一次挥手

    主动关闭方发送一个FIN，用来关闭主动方到被动关闭方的数据传送，也就是主动关闭方告诉被动关闭方：我已经不 会再给你发数据了(当然，在fin包之前发送出去的数据，如果没有收到对应的ack确认报文，主动关闭方依然会重发这些数据)，但是，此时主动关闭方还可 以接受数据。

- 第二次挥手

    被动关闭方收到FIN包后，发送一个ACK给对方，确认序号为收到序号+1（与SYN相同，一个FIN占用一个序号）

- 第三次挥手

    被动关闭方发送一个FIN，用来关闭被动关闭方到主动关闭方的数据传送，也就是告诉主动关闭方，我的数据也发送完了，不会再给你发数据了

- 第四次挥手

    主动关闭方收到FIN后，发送一个ACK给被动关闭方，确认序号为收到序号+1，至此，完成四次挥手。

![四次挥手图片](/img/waved.jpg)


### IP数据包

以太网数据包(packet)的大小是固定的，最初是1518字节，后来增加到1522字节。其中，1500字节是负载(pyload)，22字节是头部信息(head)。

IP数据包在以太网数据包的负载里面，它也有自己的头信息，最少需要20字节，所以IP数据包的负载最多为1480字节。

IP数据包

![paket数据包](/img/ipPackage.png)

> IP 数据包在以太网数据包里面，TCP 数据包在 IP 数据包里面。

TCP 数据包在 IP 数据包的负载里面。它的头信息最少也需要20字节，因此 TCP 数据包的最大负载是 1480 - 20 = 1460 字节。由于 IP 和 TCP 协议往往有额外的头信息，所以 TCP 负载实际为1400字节左右。

因此，一条1500字节的信息需要两个 TCP 数据包。HTTP/2 协议的一大改进， 就是压缩 HTTP 协议的头信息，使得一个 HTTP 请求可以放在一个 TCP 数据包里面，而不是分成多个，这样就提高了速度。

![packet数据包](/img/packet2.png)

（图片说明：以太网数据包的负载是1500字节，TCP 数据包的负载在1400字节左右。）